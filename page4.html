<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Official Merch | SeekSeveen</title>
    <link rel="icon" type="image/png" href="bmthrednobg2.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --brand-red: #980002;
            --faded-red: #6b0001;
            /* Glass Effect Variables */
            --glass-bg: rgba(15, 15, 15, 0.75);
            --glass-blur: blur(12px);
            --text-light: #ffffff;
            --text-dim: #cccccc;
            --star-color: #ffca08; /* Shopee Star Gold */
        }

        @font-face { font-family: 'Nightcore Demo'; src: url('Nightcore Demo.ttf'); }
        .nightcore { font-family: 'Nightcore Demo', Impact, sans-serif; text-transform: uppercase; letter-spacing: 2px; }

        body {
            margin: 0; font-family: 'Segoe UI', Roboto, sans-serif;
            background: url('bgtest.gif') no-repeat center center fixed;
            background-size: cover; color: var(--text-light);
            min-height: 100vh; display: flex; flex-direction: column;
            overflow-x: hidden;
        }

        /* Glass Header & Footer - User Preference Applied */
        .navbar, footer {
            background: var(--glass-bg) !important; 
            backdrop-filter: var(--glass-blur) !important;
            -webkit-backdrop-filter: var(--glass-blur) !important;
            z-index: 2000;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        footer {
            border-bottom: none;
            border-top: 1px solid rgba(255,255,255,0.1);
            padding: 40px 20px; 
            text-align: center; 
            margin-top: auto;
        }

        .navbar { padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; }
        .nav-right { display: flex; align-items: center; gap: 20px; }
        .nav-links { display: flex; gap: 20px; align-items: center; }
        .nav-links a { color: var(--text-light); text-decoration: none; font-size: 13px; font-weight: bold; text-transform: uppercase; transition: 0.3s; }
        .nav-links a:hover { color: var(--brand-red); }

        .cart-icon-btn { position: relative; cursor: pointer; font-size: 20px; transition: 0.3s; color: white; }
        .cart-icon-btn:hover { color: var(--brand-red); transform: scale(1.1); }
        #cart-count { position: absolute; top: -8px; right: -10px; background: var(--brand-red); color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 10px; display: flex; justify-content: center; align-items: center; font-weight: bold; border: 1px solid white; }

        .hamburger { display: none; font-size: 24px; cursor: pointer; color: white; transition: 0.3s; }
        .hamburger:hover { color: var(--brand-red); }

        /* Rating Styles */
        .rating-container { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 5px; 
            margin: 5px 0; 
            cursor: pointer; 
            text-decoration: none;
            transition: 0.3s;
        }
        .rating-container:hover { transform: scale(1.05); }
        .rating-container:hover .stars { text-shadow: 0 0 10px var(--star-color); }
        
        .stars { color: var(--star-color); font-size: 12px; transition: 0.3s; }
        .rating-count { color: var(--text-dim); font-size: 11px; }

        /* NEW: Live Review Notification */
        #live-review-toast {
            position: fixed; bottom: 20px; left: 20px;
            background: var(--glass-bg); backdrop-filter: var(--glass-blur);
            border: 1px solid var(--brand-red); padding: 15px;
            border-radius: 10px; z-index: 6000; display: flex; align-items: center; gap: 12px;
            transform: translateX(-150%); transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        #live-review-toast.show { transform: translateX(0); }

        /* Sidebar (Menu) */
        .sidebar {
            position: fixed; top: 0; right: -320px; width: 300px; height: 100%;
            background: rgba(10, 10, 10, 0.98); backdrop-filter: blur(25px);
            z-index: 4000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 40px 20px; border-left: 2px solid var(--brand-red);
            visibility: hidden; pointer-events: none;
        }
        .sidebar.active { right: 0; visibility: visible; pointer-events: auto; }
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 3500; display: none; }
        .sidebar-overlay.active { display: block; }
        .sidebar-link { display: block; padding: 15px; color: white; text-decoration: none; border-bottom: 1px solid #333; transition: 0.3s; font-size: 16px; }
        .sidebar-link:hover { color: var(--brand-red); padding-left: 25px; background: rgba(152,0,2,0.1); }

        /* Cart Sidebar */
        .cart-sidebar {
            position: fixed; right: -400px; top: 0; width: 350px; height: 100vh;
            background: rgba(5, 5, 5, 0.98); backdrop-filter: blur(30px);
            border-left: 2px solid var(--brand-red); z-index: 4500; transition: 0.4s ease;
            padding: 20px; display: flex; flex-direction: column; box-sizing: border-box;
        }
        .cart-sidebar.open { right: 0; }
        .cart-items { flex: 1; overflow-y: auto; margin: 20px 0; scrollbar-width: none; }
        .cart-item { display: flex; align-items: center; gap: 15px; padding: 12px; background: rgba(255,255,255,0.05); margin-bottom: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); }
        .checkout-area { border-top: 1px solid #333; padding-top: 20px; margin-top: auto; }

        /* Main Content */
        main { flex: 1; padding: 40px 5%; width: 100%; box-sizing: border-box; }
        .merch-section { text-align: center; margin-bottom: 50px; }
        
        /* Merch Title Gap Fix */
        .merch-section h1 { margin-bottom: 40px; } 

        .merch-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        
        .merch-card {
            background: var(--glass-bg); backdrop-filter: var(--glass-blur);
            border: 1px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 12px;
            cursor: pointer; transition: 0.3s; position: relative;
        }
        .merch-card:hover { transform: translateY(-10px); border-color: var(--brand-red); box-shadow: 0 10px 30px rgba(152, 0, 2, 0.4); }
        .merch-card.sold-out { filter: grayscale(0.7); opacity: 0.7; }
        .sold-out-badge { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--brand-red); color: white; padding: 5px 12px; font-weight: bold; display: none; z-index: 10; }
        .merch-card.sold-out .sold-out-badge { display: block; }

        .img-container { position: relative; width: 100%; height: 200px; overflow: hidden; border-radius: 8px; }
        .img-container img { width: 100%; height: 100%; object-fit: contain; position: absolute; top: 0; left: 0; transition: 0.4s ease; }
        .img-back { opacity: 0; transform: scale(0.9); }
        .merch-card:hover { border-color: var(--brand-red); }
        .merch-card:hover .img-front { opacity: 0; transform: scale(0.9); }
        .merch-card:hover .img-back { opacity: 1; transform: scale(1); }

        .merch-card h3 { margin-top: 20px !important; margin-bottom: 10px; }

        /* Videos */
        .video-stack { text-align: center; margin-top: 60px; }
        .video-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 30px; }
        .video-box { 
            width: 100%; max-width: 350px; aspect-ratio: 16/9; 
            background: var(--glass-bg); border-radius: 12px; 
            padding: 5px; border: 1px solid rgba(255,255,255,0.1); 
            overflow: hidden; transition: 0.4s ease; position: relative;
        }
        .video-box:hover { 
            transform: scale(1.05) rotate(1deg); 
            border-color: var(--brand-red);
            box-shadow: 0 15px 35px rgba(152, 0, 2, 0.4);
        }
        .play-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.3); display: flex; justify-content: center; align-items: center; transition: 0.3s; color: white; font-size: 30px; }

        /* Info Panel */
        .info-panel { 
            background: var(--glass-bg); 
            backdrop-filter: var(--glass-blur); 
            padding: 40px; 
            border-radius: 15px; 
            border: 1px solid rgba(152,0,2,0.3); 
            margin: 60px auto; 
            max-width: 600px; 
            width: 90%;
            text-align: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .info-list { list-style: none; padding: 0; margin: 25px 0; text-align: left; display: inline-block; }
        .info-list li { font-size: 15px; color: #eee; line-height: 2.2; margin-bottom: 8px; }
        .info-list li::before { content: "•"; color: var(--brand-red); font-weight: bold; display: inline-block; width: 1.5em; margin-left: -1em; font-size: 1.2rem; vertical-align: middle; }

        .rec-box { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.05); padding: 10px 20px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); text-decoration: none; color: white; transition: 0.3s; font-size: 13px; }
        .rec-box:hover { border-color: var(--brand-red); background: rgba(152,0,2,0.2); transform: scale(1.05); }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 5000; inset: 0; background: rgba(0,0,0,0.9); justify-content: center; align-items: center; padding: 20px; }
        .modal-content { background: #080808; width: 100%; max-width: 800px; max-height: 90vh; display: grid; grid-template-columns: 1fr 1fr; border: 1px solid var(--brand-red); border-radius: 12px; overflow-y: auto; scrollbar-width: none; position: relative; }
        #magnify-container { background: #111; height: 400px; display: flex; justify-content: center; align-items: center; overflow: hidden; cursor: zoom-in; }
        #modalImg { width: 90%; height: 90%; object-fit: contain; transition: 0.2s; pointer-events: none; }
        .btn-add { background: var(--brand-red); color: white; padding: 15px; border: none; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; text-transform: uppercase; }
        .btn-add:disabled { background: #333; color: #777; cursor: not-allowed; }
        .qty-input { background: #222; border: 1px solid #444; color: white; width: 40px; text-align: center; }
        .size-box { border: 1px solid #444; padding: 10px; cursor: pointer; color: #fff; text-align: center; flex: 1; font-size: 12px; }
        .size-box.active { border-color: var(--brand-red); background: var(--brand-red); }

        @media (max-width: 992px) {
            .nav-links { display: none; }
            .hamburger { display: block; }
            .merch-grid { grid-template-columns: repeat(2, 1fr); }
            .modal-content { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body onload="loadStocks(); initialRender(); updateCart(); setupIndividualStockTimers(); startLiveRatings();">

    <div class="sidebar-overlay" id="overlay" onclick="closeAllSidebars()"></div>

    <div id="live-review-toast">
        <i class="fas fa-user-circle" style="font-size:30px; color:var(--brand-red);"></i>
        <div style="font-size:12px;">
            <b id="toast-name">Someone</b> just reviewed <br>
            <span id="toast-product" style="color:var(--brand-red);">Merch</span> 
            <span style="color:var(--star-color);">★★★★★</span>
        </div>
    </div>

    <div id="mainSidebar" class="sidebar">
        <h3 style="text-align: center; color: var(--brand-red); letter-spacing: 2px;">MENU</h3>
        <div style="margin-top: 30px;">
            <a href="index.html" class="sidebar-link">Home</a>
            <a href="page2.html" class="sidebar-link">Map</a>
            <a href="page3.html" class="sidebar-link">Price</a>
            <a href="help.html" class="sidebar-link">Contact</a>
        </div>
    </div>

    <div class="cart-sidebar" id="cartSidebar">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 class="nightcore" style="color:var(--brand-red); margin:0;">Cart</h2>
            <span style="cursor:pointer; font-size:30px" onclick="toggleCart(false)">&times;</span>
        </div>
        <div class="cart-items" id="cart-cont"></div>
        <div class="checkout-area">
            <h3 id="total-price" style="text-align:right; margin-bottom:15px;">Total: RM 0.00</h3>
            <button id="checkout-btn" class="btn-add" onclick="location.href='checkout.html'">CHECKOUT</button>
        </div>
    </div>

    <header class="navbar">
        <a href="index.html"><img src="sslogo.png" alt="SEEKSEVEEN" style="height:40px;"></a>
        <div class="nav-right">
            <nav class="nav-links">
                <a href="page2.html">Map</a>
                <a href="page3.html">Price</a>
            </nav>
            <div class="cart-icon-btn" onclick="toggleCart(true)">
                <i class="fas fa-shopping-bag"></i>
                <div id="cart-count">0</div>
            </div>
            <i class="fas fa-bars hamburger" onclick="openSidebar()"></i>
        </div>
    </header>

    <main>
        <section class="merch-section">
            <h1 class="nightcore" style="color:var(--brand-red); font-size: 2.5rem;">OFFICIAL MERCH</h1>
            <p style="color:var(--text-dim); font-size: 14px; margin-top:-30px; margin-bottom:40px;">Exclusive BMTHKL x SEEKSEVEEN Collection</p>
            <div class="merch-grid" id="grid"></div>
        </section>

        <section class="video-stack">
            <h2 class="nightcore" style="font-size: 1.5rem;">Vibes from the Pit</h2>
            <div class="video-grid">
                <div class="video-box">
                    <a href="https://www.youtube.com/watch?v=QJJYpsA5tv8" target="_blank" style="position:relative; display:block;">
                        <img src="https://img.youtube.com/vi/QJJYpsA5tv8/maxresdefault.jpg" style="width:100%">
                        <div class="play-overlay"><i class="fas fa-play"></i></div>
                    </a>
                </div>
                <div class="video-box">
                    <a href="https://www.youtube.com/watch?v=TkV5709EG5M" target="_blank" style="position:relative; display:block;">
                        <img src="https://img.youtube.com/vi/TkV5709EG5M/maxresdefault.jpg" style="width:100%">
                        <div class="play-overlay"><i class="fas fa-play"></i></div>
                    </a>
                </div>
                <div class="video-box">
                    <a href="https://www.youtube.com/watch?v=lir3dzYIhz0" target="_blank" style="position:relative; display:block;">
                        <img src="https://img.youtube.com/vi/lir3dzYIhz0/maxresdefault.jpg" style="width:100%">
                        <div class="play-overlay"><i class="fas fa-play"></i></div>
                    </a>
                </div>
            </div>
        </section>

        <section class="info-panel">
            <h3 class="nightcore" style="color:var(--brand-red); margin-top:0;">Why Shop With Us?</h3>
            <ul class="info-list">
                <li>Authentic limited-edition concert merchandise.</li>
                <li>Fast local shipping.</li>
                <li>Real-time automated stock tracking.</li>
            </ul>
            <div style="display:flex; justify-content:center; flex-wrap:wrap; gap:15px; margin-top:10px;">
                <a href="https://www.bmthofficial.com/" target="_blank" class="rec-box"><img src="bmthstar2.png" width="20"> BMTH Official</a>
                <a href="https://www.ticket2u.com.my/event/36510/bring-me-the-horizon" target="_blank" class="rec-box"><img src="ticket2u.png" width="20"> Ticket2u</a>
            </div>
        </section>
    </main>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <span style="position:absolute; right:15px; top:10px; cursor:pointer; font-size:30px; z-index:10;" onclick="closeModal()">&times;</span>
            <div id="magnify-container" onmousemove="magnify(event)" onmouseleave="resetMagnify()">
                <img src="" id="modalImg">
            </div>
            <div style="padding:30px;">
                <h1 id="modalName" class="nightcore" style="font-size: 20px; margin:0;"></h1>
                <div class="rating-container" id="modalRating" style="justify-content:flex-start;" onclick="goToRating()"></div>
                
                <p id="modalPrice" style="color:#00ff88; font-size:24px; font-weight:bold; margin: 10px 0;"></p>
                <div id="size-area">
                    <label style="font-size:11px; font-weight:bold;">SELECT SIZE:</label>
                    <div style="display:flex; gap:8px; margin:10px 0 20px;">
                        <div class="size-box" id="sz-S" onclick="setS('S')">S</div>
                        <div class="size-box active" id="sz-M" onclick="setS('M')">M</div>
                        <div class="size-box" id="sz-L" onclick="setS('L')">L</div>
                        <div class="size-box" id="sz-XL" onclick="setS('XL')">XL</div>
                    </div>
                </div>
                <div>
                    <label style="font-size:11px; font-weight:bold;">QUANTITY:</label>
                    <div style="display:flex; align-items:center; gap:5px; margin-top:10px; margin-bottom:20px;">
                        <button class="qty-input" onclick="adjM(-1)">-</button>
                        <input type="text" id="mQty" class="qty-input" value="1" readonly>
                        <button class="qty-input" onclick="adjM(1)">+</button>
                    </div>
                </div>
                <button id="add-btn" class="btn-add" onclick="addToCart()">ADD TO CART</button>
                <p id="stock-status" style="color:var(--brand-red); font-size:11px; margin-top:15px; font-weight:bold;"></p>
            </div>
        </div>
    </div>

    <footer>
        <div style="margin-bottom:10px;">
            <a href="terms.html" style="color:var(--text-dim); text-decoration:none; margin:0 10px; font-size:12px;">Terms & Condition</a>
            <a href="privacy.html" style="color:var(--text-dim); text-decoration:none; margin:0 10px; font-size:12px;">Privacy Policy</a>
            <a href="help.html" style="color:var(--text-dim); text-decoration:none; margin:0 10px; font-size:12px;">Help & Support</a>
        </div>
        <p style="color:#777; font-size:11px;">© 2026 Und Performance Group. All Rights Reserved.</p>
    </footer>

    <script>
        const hasReset_v1 = "bmth_stable_v4"; 
        const stockInitialValues = {
            1: { S: 390, M: 200, L: 450, XL: 780 },
            2: { S: 777, M: 777, L: 777, XL: 777 },
            3: { S: 500, M: 600, L: 200, XL: 157 },
            4: { S: 2500, M: 2500, L: 2700, XL: 3200 },
            5: { qty: 4231 },
            6: { qty: 600 },
            7: { qty: 142 },
            8: { qty: 843 }
        };

        const stockSpeeds = { 1: 300, 2: 200, 3: 800, 4: 400, 5: 1000, 6: 300, 7: 5000, 8: 100 };

        let products = [
            { id: 1, name: 'NO LVE LIKE UR OWN LSLEEVE', price: 299, hasSize: true, img: 'swshirt.png', imgB: 'swshirt2.png', rating: 4.2, reviewCount: 429 },
            { id: 2, name: 'SEEKSEVEEN x BMTHKL', price: 399, hasSize: true, img: 'ssxbmthv2f.png', imgB: 'ssxbmthv1b.png', rating: 3.8, reviewCount: 56 },
            { id: 3, name: 'DYING TO LIVE HOODIE', price: 499, hasSize: true, img: 'hoodie1f.png', imgB: 'hoodie1b.png', rating: 4.1, reviewCount: 440 },
            { id: 4, name: 'SOF HOODIE', price: 599, hasSize: true, img: 'hoodie2f.png', imgB: 'hoodie2b.png', rating: 3.9, reviewCount: 45 },
            { id: 5, name: 'DREAMSEEKER BEANIE', price: 119, hasSize: false, img: 'topi.png', imgB: 'topi2.png', rating: 2.7, reviewCount: 749 },
            { id: 6, name: 'YOUTOPIA CAMO CAP', price: 299, hasSize: false, img: 'cap.png', imgB: 'cap2.png', rating: 4.3, reviewCount: 643 },
            { id: 7, name: 'BMTH NECKLACE', price: 999, hasSize: false, img: 'necklace.png', imgB: 'necklace2.png', rating: 3.3, reviewCount: 17 },
            { id: 8, name: 'ANOMALI BMTH', price: 99, hasSize: false, img: 'keychainf.png', imgB: 'keychainb.png', rating: 1.7, reviewCount: 932 }
        ];

        let stocks = {};
        let cart = JSON.parse(localStorage.getItem('bmth_cart')) || [];
        let curr = null, selSize = 'M', mQty = 1;

        // Navigation to Ratings
        function goToRating(id) {
            const targetId = id || (curr ? curr.id : 1);
            localStorage.setItem('selected_rating_id', targetId);
            window.location.href = 'rating.html';
        }

        // Live Rating Simulation Logic
        function startLiveRatings() {
            setInterval(() => {
                if (Math.random() > 0.85) { // 15% chance every 4 seconds
                    const p = products[Math.floor(Math.random() * products.length)];
                    p.reviewCount++;
                    
                    // Update UI
                    const countEl = document.querySelector(`#p-${p.id} .rating-count`);
                    if(countEl) countEl.innerText = `(${p.reviewCount})`;

                    // Show Toast
                    showToast(p.name);
                }
            }, 4000);
        }

        function showToast(prodName) {
            const names = ["Ahmad", "Kevin", "Sarah", "Nurul", "Alex", "Ziq", "Fikri", "Vicky"];
            const toast = document.getElementById('live-review-toast');
            document.getElementById('toast-name').innerText = names[Math.floor(Math.random() * names.length)];
            document.getElementById('toast-product').innerText = prodName;
            
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function loadStocks() {
            const saved = localStorage.getItem('bmth_stocks');
            if (saved && localStorage.getItem('bmth_ver') === hasReset_v1) { stocks = JSON.parse(saved); } 
            else { stocks = JSON.parse(JSON.stringify(stockInitialValues)); saveStocks(); localStorage.setItem('bmth_ver', hasReset_v1); }
        }

        function generateStars(rating) {
            let h = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= Math.floor(rating)) h += '<i class="fas fa-star"></i>';
                else if (i === Math.ceil(rating) && rating % 1 !== 0) h += '<i class="fas fa-star-half-alt"></i>';
                else h += '<i class="far fa-star"></i>';
            }
            return h;
        }

        function initialRender() {
            const g = document.getElementById('grid'); g.innerHTML = '';
            products.forEach(p => {
                g.innerHTML += `
                <div class="merch-card" id="p-${p.id}" onclick="openM(${p.id})">
                    <div class="sold-out-badge">SOLD OUT</div>
                    <div class="img-container"><img src="${p.img}" class="img-front"><img src="${p.imgB}" class="img-back"></div>
                    <h3 class="nightcore" style="color:white; font-size:13px;">${p.name}</h3>
                    <div class="rating-container" onclick="event.stopPropagation(); goToRating(${p.id})">
                        <div class="stars">${generateStars(p.rating)}</div>
                        <div class="rating-count">(${p.reviewCount})</div>
                    </div>
                    <p style="color:#00ff88; font-size:14px; margin:5px 0;">RM ${p.price.toFixed(2)}</p>
                </div>`;
            });
            updateStockVisuals();
        }

        function updateStockVisuals() {
            products.forEach(p => {
                const s = stocks[p.id];
                const total = p.hasSize ? (s.S + s.M + s.L + s.XL) : s.qty;
                const card = document.getElementById(`p-${p.id}`);
                if (total <= 0) card.classList.add('sold-out'); else card.classList.remove('sold-out');
            });
            if (curr) updateStockUI();
        }

        function openM(id) {
            curr = products.find(p => p.id === id);
            mQty = 1; document.getElementById('mQty').value = 1;
            document.getElementById('modalName').innerText = curr.name;
            document.getElementById('modalPrice').innerText = 'RM ' + curr.price.toFixed(2);
            document.getElementById('modalImg').src = curr.img;
            document.getElementById('size-area').style.display = curr.hasSize ? 'block' : 'none';
            document.getElementById('modalRating').innerHTML = `<div class="stars">${generateStars(curr.rating)}</div><div class="rating-count">(${curr.reviewCount} Reviews)</div>`;
            updateStockUI();
            document.getElementById('productModal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('productModal').style.display = 'none'; curr = null; }

        function updateStockUI() {
            if (!curr) return;
            const s = stocks[curr.id];
            const left = curr.hasSize ? s[selSize] : s.qty;
            const btn = document.getElementById('add-btn');
            btn.disabled = left <= 0;
            btn.innerText = left <= 0 ? "SOLD OUT" : "ADD TO CART";
            document.getElementById('stock-status').innerText = (curr.hasSize ? `SIZE ${selSize} ` : '') + `STOCK: ${left} LEFT`;
        }

        function adjM(n) {
            const max = curr.hasSize ? stocks[curr.id][selSize] : stocks[curr.id].qty;
            if (mQty + n >= 1 && mQty + n <= max) { mQty += n; document.getElementById('mQty').value = mQty; }
        }

        function setS(s) { 
            selSize = s; 
            document.querySelectorAll('.size-box').forEach(b => b.classList.remove('active')); 
            document.getElementById('sz-'+s).classList.add('active'); 
            mQty = 1; document.getElementById('mQty').value = 1; updateStockUI(); 
        }

        function addToCart() {
            const sz = curr.hasSize ? selSize : 'N/A';
            if(curr.hasSize) stocks[curr.id][selSize] -= mQty; else stocks[curr.id].qty -= mQty;
            const ex = cart.find(i => i.id === curr.id && i.size === sz);
            if(ex) ex.q += mQty; else cart.push({...curr, size: sz, q: mQty});
            saveStocks(); updateCart(); closeModal(); toggleCart(true); updateStockVisuals();
        }

        function updateCart() {
            const cont = document.getElementById('cart-cont'); cont.innerHTML = ''; let t = 0;
            localStorage.setItem('bmth_cart', JSON.stringify(cart)); 
            cart.forEach((item, i) => {
                t += item.price * item.q;
                cont.innerHTML += `<div class="cart-item"><img src="${item.img}" width="40"><div style="flex:1; font-size:12px;"><b>${item.name}</b><br>RM ${item.price} x ${item.q}</div><button onclick="removeI(${i})" style="color:red; background:none; border:none; cursor:pointer; font-size:20px;">&times;</button></div>`;
            });
            document.getElementById('total-price').innerText = 'Total: RM ' + t.toFixed(2);
            document.getElementById('cart-count').innerText = cart.reduce((a,b) => a+b.q, 0);
        }

        function removeI(i) {
            const item = cart[i];
            if(item.size !== 'N/A') stocks[item.id][item.size] += item.q; else stocks[item.id].qty += item.q;
            cart.splice(i,1); saveStocks(); updateCart(); updateStockVisuals();
        }

        function magnify(e) {
            const c = document.getElementById('magnify-container'), i = document.getElementById('modalImg');
            const { left, top, width, height } = c.getBoundingClientRect();
            const x = ((e.clientX - left) / width) * 100, y = ((e.clientY - top) / height) * 100;
            i.style.transformOrigin = `${x}% ${y}%`; i.style.transform = "scale(2.5)";
        }
        function resetMagnify() { document.getElementById('modalImg').style.transform = "scale(1)"; }
        function openSidebar() { document.getElementById('mainSidebar').classList.add('active'); document.getElementById('overlay').classList.add('active'); }
        function toggleCart(o) { document.getElementById('cartSidebar').classList.toggle('open', o); document.getElementById('overlay').classList.toggle('active', o); }
        function closeAllSidebars() { document.getElementById('mainSidebar').classList.remove('active'); document.getElementById('cartSidebar').classList.remove('open'); document.getElementById('overlay').classList.remove('active'); }
        function saveStocks() { localStorage.setItem('bmth_stocks', JSON.stringify(stocks)); }

        function setupIndividualStockTimers() {
            products.forEach(p => {
                const speed = stockSpeeds[p.id] || 1000;
                setInterval(() => {
                    const s = stocks[p.id];
                    let changed = false;
                    if(p.hasSize) { 
                        ['S','M','L','XL'].forEach(sz => { 
                            if(s[sz] > 0 && Math.random() > 0.95) { s[sz]--; changed = true; } 
                        }); 
                    } else { 
                        if(s.qty > 0 && Math.random() > 0.95) { s.qty--; changed = true; } 
                    }
                    if(changed) { saveStocks(); updateStockVisuals(); }
                }, speed);
            });
        }
    </script>
</body>
</html>